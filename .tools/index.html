<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Clean Multi Counter</title>

<style>
:root {
  --bg:#0b0b0b;
  --fg:#ffffff;
  --muted:#666;
  --line:#ffffff;
}

* {
  box-sizing:border-box;
  font-family:system-ui,sans-serif;
}

body {
  margin:0;
  background:var(--bg);
  color:var(--fg);
  height:100vh;
  display:flex;
  flex-direction:column;
}

/* HEADER */
header {
  display:flex;
  justify-content:space-between;
  padding:10px 14px;
}

header button {
  background:none;
  border:none;
  color:var(--fg);
  font-size:20px;
}

/* MAIN */
main {
  flex:1;
  display:flex;
  flex-direction:column;
}

/* TIMER */
.timer {
  flex:1;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
}

/* NUMBER */
.number {
  font-size:clamp(42px, 11vh, 96px);
  user-select:none;
}

/* CONTROLS */
.controls {
  display:flex;
  gap:30px;
  margin-top:6px;
}

.controls button {
  background:none;
  border:none;
  color:var(--fg);
  font-size:32px;
}

/* LABEL */
.label {
  margin-top:8px;
  background:none;
  border:none;
  color:var(--muted);
  text-align:center;
  font-size:14px;
  width:80%;
}

/* SEPARATOR */
.separator {
  width:100%;
  height:1px;
  background:var(--line);
  margin-top:12px;
}

/* OVERVIEW */
.overlay {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.95);
  display:none;
  padding:20px;
}

.overlay.active {
  display:block;
}

.overlay header {
  display:flex;
  justify-content:space-between;
  margin-bottom:20px;
}
</style>
</head>

<body>

<header>
  <button onclick="resetAll()">\</button>
  <div>
    <button onclick="addTimer()">+</button>
    <button onclick="removeTimer()">-</button>
    <button onclick="toggleOverlay()">✔</button>
  </div>
</header>

<main id="timers"></main>

<div class="overlay" id="overlay">
  <header>
    <h2>Overview</h2>
    <button onclick="toggleOverlay()">✕</button>
  </header>
  <div id="overviewContent"></div>
</div>

<script>
let state = JSON.parse(localStorage.getItem("state")) || {
  timers:[{ value:0, label:"" }]
};

const timersEl = document.getElementById("timers");
const overlay = document.getElementById("overlay");
const overviewContent = document.getElementById("overviewContent");

/* HAPTIC */
function haptic() {
  if (navigator.vibrate) navigator.vibrate(10);
}

function save() {
  localStorage.setItem("state", JSON.stringify(state));
}

function resetAll() {
  state = { timers:[{ value:0, label:"" }] };
  save();
  render();
}

function addTimer() {
  if (state.timers.length >= 4) return;
  state.timers.push({ value:0, label:"" });
  save();
  render();
}

function removeTimer() {
  if (state.timers.length <= 1) return;
  state.timers.pop();
  save();
  render();
}

function toggleOverlay() {
  overlay.classList.toggle("active");
  if (overlay.classList.contains("active")) renderOverview();
}

/* TOUCH HANDLER */
function attachTouch(el, onRight, onLeft, onTap) {
  let startX = 0;
  let moved = false;

  el.addEventListener("touchstart", e => {
    startX = e.touches[0].clientX;
    moved = false;
  }, {passive:true});

  el.addEventListener("touchmove", e => {
    if (Math.abs(e.touches[0].clientX - startX) > 10) moved = true;
  }, {passive:true});

  el.addEventListener("touchend", e => {
    const dx = e.changedTouches[0].clientX - startX;
    if (moved && dx > 40) onRight();
    else if (moved && dx < -40) onLeft();
    else onTap();
  });
}

function render() {
  timersEl.innerHTML = "";
  const showLine = state.timers.length > 1;

  state.timers.forEach((t,i) => {
    const div = document.createElement("div");
    div.className = "timer";

    const num = document.createElement("div");
    num.className = "number";
    num.textContent = t.value;

    attachTouch(
      num,
      () => { t.value++; haptic(); save(); render(); },                // swipe right
      () => { if (t.value > 0) { t.value--; haptic(); save(); render(); } }, // swipe left
      () => { t.value++; haptic(); save(); render(); }                 // tap
    );

    const ctrls = document.createElement("div");
    ctrls.className = "controls";

    const minus = document.createElement("button");
    minus.textContent = "−";
    minus.onclick = () => {
      if (t.value > 0) {
        t.value--;
        haptic();
        save();
        render();
      }
    };

    const plus = document.createElement("button");
    plus.textContent = "+";
    plus.onclick = () => {
      t.value++;
      haptic();
      save();
      render();
    };

    const label = document.createElement("input");
    label.className = "label";
    label.placeholder = "label";
    label.value = t.label;
    label.oninput = e => {
      t.label = e.target.value;
      save();
    };

    ctrls.append(minus, plus);
    div.append(num, ctrls, label);

    if (showLine && i < state.timers.length - 1) {
      const sep = document.createElement("div");
      sep.className = "separator";
      div.appendChild(sep);
    }

    timersEl.appendChild(div);
  });
}

function renderOverview() {
  overviewContent.innerHTML = "";

  const total = state.timers.reduce((s,t)=>s+t.value,0);
  const multiple = state.timers.length > 1;

  state.timers.forEach((t,i) => {
    let text = `${t.value}`;
    if (multiple && total > 0) {
      text = `${t.value}/${total} (${Math.round(t.value/total*100)}%)`;
    }

    overviewContent.innerHTML += `
      <div style="margin-bottom:12px">
        <div style="color:var(--muted)">${t.label || `Counter ${i+1}`}</div>
        <div>${text}</div>
      </div>
    `;
  });
}

render();
</script>

</body>
</html>