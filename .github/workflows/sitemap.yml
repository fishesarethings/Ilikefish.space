      - name: Generate SEO files
        env:
          BASE_URL: "https://ilikefish.space"
        run: |
          set -euo pipefail
          node <<'EOF'
          const fs = require('fs');
          const path = require('path');

          const BASE = process.env.BASE_URL;
          const ROOT = process.cwd();
          const GAMES_DIR = path.join(ROOT, 'games');

          const now = new Date().toISOString();
          const urls = new Map();

          // === HELPER ===
          const addUrl = (loc, freq = 'monthly', prio = '0.6') => {
            urls.set(loc, { loc, changefreq: freq, priority: prio });
          };

          // === STATIC PAGES ===
          [
            '/',
            '/games.html',
            '/gamepack.html',
            '/terms.html',
            '/privacy.html'
          ].forEach(p => addUrl(BASE + p, 'weekly', '0.8'));

          // === GAME PAGES (AUTO DISCOVERY) ===
          if (fs.existsSync(GAMES_DIR)) {
            const entries = fs.readdirSync(GAMES_DIR, { withFileTypes: true });

            for (const e of entries) {
              if (!e.isDirectory()) continue;

              const slug = e.name;
              if (slug.toLowerCase() === 'pong') continue;

              const folder = path.join(GAMES_DIR, slug);
              const indexHtml = path.join(folder, 'index.html');

              // Prefer folder URL
              addUrl(`${BASE}/games/${slug}/`, 'monthly', '0.6');

              // Also include standalone html if it exists
              if (fs.existsSync(indexHtml)) {
                addUrl(`${BASE}/games/${slug}/index.html`, 'monthly', '0.5');
              }
            }
          }

          // === BUILD XML ===
          const sitemap =
            `<?xml version="1.0" encoding="UTF-8"?>\n` +
            `<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">\n` +
            [...urls.values()].map(u =>
              `  <url>\n` +
              `    <loc>${u.loc}</loc>\n` +
              `    <lastmod>${now}</lastmod>\n` +
              `    <changefreq>${u.changefreq}</changefreq>\n` +
              `    <priority>${u.priority}</priority>\n` +
              `  </url>`
            ).join('\n') +
            `\n</urlset>\n`;

          fs.writeFileSync('sitemap.xml', sitemap);
          console.log(`✅ sitemap.xml generated (${urls.size} URLs)`);

          // === ROBOTS.TXT ===
          fs.writeFileSync(
            'robots.txt',
            `User-agent: *\nAllow: /\n\nSitemap: ${BASE}/sitemap.xml\n`
          );

          console.log('✅ robots.txt updated');
          EOF
